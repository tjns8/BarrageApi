// Sequenced v0.9.1 | arielyang@github | MIT Licensed
var CanvasHelper,DefinationParser,Sequenced;Sequenced=function(){function e(){}var t,n,r,i,o,a,l,s,c,u,d,f,h,v,b,g,m,w,T,x,p,C,P,S,j,D,I,O,y;return r="#c0c0c0",t="#80aada",n="#f7ab42",i=800,c=120,s=40,a="Arial",o="#000",l=12,d=48,u=10,e.COLOR_OBJECT=["#fdd9b4","#bae0ec","#c2e2c7","#e5cff4","#c9d1f7","#f8cdd4"],b=null,I=null,D=null,C=null,p=null,P=null,f=null,y=null,h=null,v=null,e.renderAll=function(){var e,t,n,r;for(j(),e=document.getElementsByTagName("canvas"),r=[],t=0,n=e.length;n>t;t++)f=e[t],r.push(f.hasAttribute("sequenced")?O(f):void 0);return r},e.render=function(e){return j(),f=document.getElementById(e),O(f)},e.setObjectSize=function(e,t){return I=e,D=t},e.setFontFamily=function(e){return C=e},e.setFontColor=function(e){return p=e},e.setFontSize=function(e){return P=e},O=function(e){return y=DefinationParser.getSequenceData(e),S(),x(),w()},S=function(){var e,t,n,r,o;return h=D+d*(y.maxRow+2/3-.5),v=(i-I-2*u)/(y.objectCount-1),CanvasHelper.defineColumnWidth(v),o=parseInt(f.width),e=(h+2*u)/i*o,r=2*o,n=2*e,t=r/i,f.style.width=o+"px",f.style.height=e+"px",f.width=r,f.height=n,b=f.getContext("2d"),b.scale(t,t)},j=function(){return null===I&&(I=c),null===D&&(D=s),null===C&&(C=a),null===p&&(p=o),null===P?P=l:void 0},x=function(){var e,t,n,r,i,o;e=0,o=[];for(n in y.objects)r=u+v*e++,i=u,t=y.objects[n],o.push(T(r,i,I,D,n,t));return o},T=function(n,i,o,a,l,s){var c;return c=function(t){var n;return n=t>5?t-6:t,e.COLOR_OBJECT[n]},CanvasHelper.drawLifeline(b,n+I/2,i+D,d*y.maxRow,"#fff",t),g(n,i,s),CanvasHelper.drawRoundedRect(b,n,i,o,a,c(s.id),r,5),CanvasHelper.drawWrapText(b,l,n+I/2,i+D/2+P/3,I-10,"bold",P,p,C)},g=function(e,n,r){var i,o,a,l,s,c,f;for(c=r.activations,f=[],l=0,s=c.length;s>l;l++)i=c[l],a=1===i?u+D:u+D+d*(i-5/6),o=1===i?d*(1+1/6):d,f.push(CanvasHelper.drawActivation(b,e+I/2,a,o,d*y.maxRow,"#fff",t));return f},w=function(){var e,t,n,r,i;for(r=y.messages,i=[],t=0,n=r.length;n>t;t++)e=r[t],i.push(m(e));return i},m=function(e){var t,r,o,a,l;switch(t=function(e){return u+I/2+(i-I-2*u)/(y.objectCount-1)*e},l=d*(e.row+2/3),e.direction){case"self":return r=t(e.fromObjectIndex),CanvasHelper.drawSelfArrow(b,r,l-3*d/8,l+3*d/8,n,P,p,C,e.text,e.isDashed);case"right":return o=t(e.fromObjectIndex),a=t(e.toObjectIndex),CanvasHelper.drawRightArrow(b,o,a,l,n,P,p,C,e.text,e.isDashed);case"left":return o=t(e.toObjectIndex),a=t(e.fromObjectIndex),CanvasHelper.drawLeftArrow(b,o,a,l,n,P,p,C,e.text,e.isDashed)}},e}(),CanvasHelper=function(){function e(){}var t,n,r,i;return r=8,t=12,n=8,i=null,e.defineColumnWidth=function(e){return i=e},e.drawRect=function(e,t,n,r,i,o){return e.fillStyle=o,e.fillRect(t,n,r,i)},e.drawRoundedRect=function(e,t,n,r,i,o,a,l){return t+=.5,n+=.5,e.beginPath(),e.arc(t+l,n+l,l,Math.PI,1.5*Math.PI),e.lineTo(t+r-2*l,n),e.arc(t+r-l,n+l,l,1.5*Math.PI,2*Math.PI),e.lineTo(t+r,n+i-l),e.arc(t+r-l,n+i-l,l,0,.5*Math.PI),e.lineTo(t+l,n+i),e.arc(t+l,n+i-l,l,.5*Math.PI,Math.PI),e.lineTo(t,n+l),e.closePath(),e.fillStyle=o,e.fill(),e.lineWidth=1,e.strokeStyle=a,e.stroke()},e.drawRightArrow=function(e,i,o,a,l,s,c,u,d,f){return e.setLineDash(f?[n,n]:[1,0]),i=i+t-r/2,o=o-t+r/2,e.beginPath(),e.moveTo(o-n,a),e.lineTo(i,a),e.lineDashOffset=n/3,e.strokeStyle=l,e.lineWidth=n,e.stroke(),e.setLineDash([1,0]),e.beginPath(),e.moveTo(o-n,a-n),e.lineTo(o,a),e.lineTo(o-n,a+n),e.closePath(),e.fillStyle=l,e.fill(),this.drawWrapText(e,d,(i+o)/2,a-s,o-i-s,"normal",s,c,u,"center",!0)},e.drawLeftArrow=function(e,i,o,a,l,s,c,u,d,f){return e.setLineDash(f?[n,n]:[1,0]),i=i+t-r/2,o=o-t+r/2,e.beginPath(),e.moveTo(i+n,a),e.lineTo(o,a),e.lineDashOffset=n/3,e.strokeStyle=l,e.lineWidth=n,e.stroke(),e.setLineDash([1,0]),e.beginPath(),e.lineTo(i+n,a-n),e.lineTo(i,a),e.lineTo(i+n,a+n),e.closePath(),e.fillStyle=l,e.fill(),this.drawWrapText(e,d,(i+o)/2,a-s,o-i-s,"normal",s,c,u,"center",!0)},e.drawSelfArrow=function(e,o,a,l,s,c,u,d,f,h){var v;return e.setLineDash(h?[n,n]:[1,0]),o=o+t-r/2,a+=n/2,l-=n/2,v=(l-a)/2,e.beginPath(),e.moveTo(o,a),e.lineTo(o+n,a),e.arc(o+n,a+v,v,1.5*Math.PI,.5*Math.PI,!1),e.lineDashOffset=2,e.strokeStyle=s,e.lineWidth=n,e.stroke(),e.setLineDash([1,0]),e.beginPath(),e.lineTo(o+n,l-n),e.lineTo(o,l),e.lineTo(o+n,l+n),e.closePath(),e.fillStyle=s,e.fill(),this.drawWrapText(e,f,o+2*n+v,(a+l)/2+c/2,i-v-2*n-c,"normal",c,u,d,"left")},e.drawLifeline=function(e,t,n,i,o,a){var l;return l=e.createLinearGradient(0,0,0,i),l.addColorStop(0,o),l.addColorStop(1,a),e.beginPath(),e.moveTo(t,n+i),e.lineTo(t,n),e.setLineDash([2*r,r]),e.strokeStyle=l,e.lineWidth=r,e.stroke(),e.setLineDash([1,0])},e.drawActivation=function(e,n,r,i,o,a,l){var s;return s=e.createLinearGradient(0,0,0,o),s.addColorStop(0,a),s.addColorStop(1,l),e.beginPath(),e.moveTo(n,r+i),e.lineTo(n,r),e.strokeStyle=s,e.lineWidth=t,e.stroke()},e.drawWrapText=function(e,t,r,i,o,a,l,s,c,u,d){var f,h,v,b,g,m,w,T,x,p;for(e.font=""+a+" "+l+"px "+c,e.textAlign=u?u:"center",e.fillStyle=s,r+=1*l/3,b=/\\n/.test(t)?"\\n":" ",w=t.split(b),h="",T=0,v=d?2*n+2*l:1.2*l,f=x=0,p=w.length;p>=0?p>x:x>p;f=p>=0?++x:--x)g=h+w[f]+" ",m=e.measureText(g).width,m>o&&f>0?(T=l/2,d?e.fillText(h,r,i):e.fillText(h,r,i-T),h=w[f]+" ",i+=v):h=g;return e.fillText(h,r,i-T)},e}(),DefinationParser=function(){function e(){}return e.getSequenceData=function(e){var t,n,r,i,o,a,l,s,c,u,d,f,h,v,b,g;for(i=function(e){return 0===e.childNodes.length?"":e.childNodes[0].nodeValue},t=function(e,t){var n;return n=v.objects[e],0===n.activations.length?n.activations.push(t):n.activations[n.activations.length-1]!==t?n.activations.push(t):void 0},f=/(.+\b) *(-->|->) *(.+\b) *: *(.+)\n?/gm,v={objects:{},objectCount:0,messages:[],maxRow:0},o=i(e),c=0;a=f.exec(o);)s=a[1].trim(),l=a[2].trim(),u=a[3].trim(),b=a[4].trim(),void 0===v.objects[s]&&(v.objects[s]={id:c,activations:[]},c++),void 0===v.objects[u]&&(v.objects[u]={id:c,activations:[]},c++),r=v.objects[s].id,g=v.objects[u].id,n=s===u?"self":r>g?"left":"right",0===v.messages.length?h=1:(d=v.messages[v.messages.length-1],h=r===d.toObjectIndex&&n===d.direction&&d.direction===!1?d.row:d.row+1),t(s,h),t(u,h),v.messages.push({text:b,direction:n,fromObjectIndex:r,toObjectIndex:g,isDashed:/--/.test(l),row:h}),v.objectCount=c,v.maxRow=h;return v},e}();